#include "ExternalDAC.h"

extern const uint16_t sine_wave[900] = {
    1862, 1874, 1887, 1900, 1913, 1926, 1939, 1952, 1965, 1978, 1991, 2004, 2017, 2030, 2043, 2056,
    2069, 2082, 2095, 2108, 2121, 2133, 2146, 2159, 2172, 2185, 2198, 2210, 2223, 2236, 2249, 2261,
    2274, 2287, 2299, 2312, 2324, 2337, 2350, 2362, 2375, 2387, 2400, 2412, 2424, 2437, 2449, 2461,
    2474, 2486, 2498, 2510, 2523, 2535, 2547, 2559, 2571, 2583, 2595, 2607, 2619, 2630, 2642, 2654,
    2666, 2678, 2689, 2701, 2712, 2724, 2735, 2747, 2758, 2770, 2781, 2792, 2803, 2815, 2826, 2837,
    2848, 2859, 2870, 2881, 2892, 2902, 2913, 2924, 2935, 2945, 2956, 2966, 2977, 2987, 2997, 3008,
    3018, 3028, 3038, 3048, 3058, 3068, 3078, 3088, 3097, 3107, 3117, 3126, 3136, 3145, 3155, 3164,
    3173, 3182, 3191, 3201, 3210, 3218, 3227, 3236, 3245, 3254, 3262, 3271, 3279, 3287, 3296, 3304,
    3312, 3320, 3328, 3336, 3344, 3352, 3360, 3367, 3375, 3383, 3390, 3397, 3405, 3412, 3419, 3426,
    3433, 3440, 3447, 3454, 3460, 3467, 3474, 3480, 3486, 3493, 3499, 3505, 3511, 3517, 3523, 3529,
    3535, 3540, 3546, 3551, 3557, 3562, 3567, 3572, 3578, 3583, 3587, 3592, 3597, 3602, 3606, 3611,
    3615, 3619, 3624, 3628, 3632, 3636, 3640, 3644, 3647, 3651, 3654, 3658, 3661, 3665, 3668, 3671,
    3674, 3677, 3680, 3682, 3685, 3688, 3690, 3692, 3695, 3697, 3699, 3701, 3703, 3705, 3707, 3708,
    3710, 3711, 3713, 3714, 3715, 3716, 3718, 3718, 3719, 3720, 3721, 3721, 3722, 3722, 3723, 3723,
    3723, 3723, 3723, 3723, 3723, 3722, 3722, 3721, 3721, 3720, 3719, 3718, 3718, 3716, 3715, 3714,
    3713, 3711, 3710, 3708, 3707, 3705, 3703, 3701, 3699, 3697, 3695, 3692, 3690, 3688, 3685, 3682,
    3680, 3677, 3674, 3671, 3668, 3665, 3661, 3658, 3654, 3651, 3647, 3644, 3640, 3636, 3632, 3628,
    3624, 3619, 3615, 3611, 3606, 3602, 3597, 3592, 3587, 3583, 3578, 3572, 3567, 3562, 3557, 3551,
    3546, 3540, 3535, 3529, 3523, 3517, 3511, 3505, 3499, 3493, 3486, 3480, 3474, 3467, 3460, 3454,
    3447, 3440, 3433, 3426, 3419, 3412, 3405, 3397, 3390, 3383, 3375, 3367, 3360, 3352, 3344, 3336,
    3328, 3320, 3312, 3304, 3296, 3287, 3279, 3271, 3262, 3254, 3245, 3236, 3227, 3218, 3210, 3201,
    3191, 3182, 3173, 3164, 3155, 3145, 3136, 3126, 3117, 3107, 3097, 3088, 3078, 3068, 3058, 3048,
    3038, 3028, 3018, 3008, 2997, 2987, 2977, 2966, 2956, 2945, 2935, 2924, 2913, 2902, 2892, 2881,
    2870, 2859, 2848, 2837, 2826, 2815, 2803, 2792, 2781, 2770, 2758, 2747, 2735, 2724, 2712, 2701,
    2689, 2678, 2666, 2654, 2642, 2630, 2619, 2607, 2595, 2583, 2571, 2559, 2547, 2535, 2523, 2510,
    2498, 2486, 2474, 2461, 2449, 2437, 2424, 2412, 2400, 2387, 2375, 2362, 2350, 2337, 2324, 2312,
    2299, 2287, 2274, 2261, 2249, 2236, 2223, 2210, 2198, 2185, 2172, 2159, 2146, 2133, 2121, 2108,
    2095, 2082, 2069, 2056, 2043, 2030, 2017, 2004, 1991, 1978, 1965, 1952, 1939, 1926, 1913, 1900,
    1887, 1874, 1862, 1849, 1836, 1823, 1810, 1797, 1784, 1771, 1758, 1745, 1732, 1719, 1706, 1693,
    1680, 1667, 1654, 1641, 1628, 1615, 1602, 1590, 1577, 1564, 1551, 1538, 1525, 1513, 1500, 1487,
    1474, 1462, 1449, 1436, 1424, 1411, 1399, 1386, 1373, 1361, 1348, 1336, 1323, 1311, 1299, 1286,
    1274, 1262, 1249, 1237, 1225, 1213, 1200, 1188, 1176, 1164, 1152, 1140, 1128, 1116, 1104, 1093,
    1081, 1069, 1057, 1045, 1034, 1022, 1011, 999, 988, 976, 965, 953, 942, 931, 920, 908,
    897, 886, 875, 864, 853, 842, 831, 821, 810, 799, 788, 778, 767, 757, 746, 736,
    726, 715, 705, 695, 685, 675, 665, 655, 645, 635, 626, 616, 606, 597, 587, 578,
    568, 559, 550, 541, 532, 522, 513, 505, 496, 487, 478, 469, 461, 452, 444, 436,
    427, 419, 411, 403, 395, 387, 379, 371, 363, 356, 348, 340, 333, 326, 318, 311,
    304, 297, 290, 283, 276, 269, 263, 256, 249, 243, 237, 230, 224, 218, 212, 206,
    200, 194, 188, 183, 177, 172, 166, 161, 156, 151, 145, 140, 136, 131, 126, 121,
    117, 112, 108, 104, 99, 95, 91, 87, 83, 79, 76, 72, 69, 65, 62, 58,
    55, 52, 49, 46, 43, 41, 38, 35, 33, 31, 28, 26, 24, 22, 20, 18,
    16, 15, 13, 12, 10, 9, 8, 7, 5, 5, 4, 3, 2, 2, 1, 1,
    0, 0, 0, 0, 0, 0, 0, 1, 1, 2, 2, 3, 4, 5, 5, 7,
    8, 9, 10, 12, 13, 15, 16, 18, 20, 22, 24, 26, 28, 31, 33, 35,
    38, 41, 43, 46, 49, 52, 55, 58, 62, 65, 69, 72, 76, 79, 83, 87,
    91, 95, 99, 104, 108, 112, 117, 121, 126, 131, 136, 140, 145, 151, 156, 161,
    166, 172, 177, 183, 188, 194, 200, 206, 212, 218, 224, 230, 237, 243, 249, 256,
    263, 269, 276, 283, 290, 297, 304, 311, 318, 326, 333, 340, 348, 356, 363, 371,
    379, 387, 395, 403, 411, 419, 427, 436, 444, 452, 461, 469, 478, 487, 496, 505,
    513, 522, 532, 541, 550, 559, 568, 578, 587, 597, 606, 616, 626, 635, 645, 655,
    665, 675, 685, 695, 705, 715, 726, 736, 746, 757, 767, 778, 788, 799, 810, 821,
    831, 842, 853, 864, 875, 886, 897, 908, 920, 931, 942, 953, 965, 976, 988, 999,
    1011, 1022, 1034, 1045, 1057, 1069, 1081, 1093, 1104, 1116, 1128, 1140, 1152, 1164, 1176, 1188,
    1200, 1213, 1225, 1237, 1249, 1262, 1274, 1286, 1299, 1311, 1323, 1336, 1348, 1361, 1373, 1386,
    1399, 1411, 1424, 1436, 1449, 1462, 1474, 1487, 1500, 1513, 1525, 1538, 1551, 1564, 1577, 1590,
    1602, 1615, 1628, 1641, 1654, 1667, 1680, 1693, 1706, 1719, 1732, 1745, 1758, 1771, 1784, 1797,
    1810, 1823, 1836, 1849,
};
extern const uint16_t square_wave[900] = {
    3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723,
    3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723,
    3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723,
    3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723,
    3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723,
    3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723,
    3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723,
    3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723,
    3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723,
    3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723,
    3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723,
    3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723,
    3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723,
    3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723,
    3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723,
    3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723,
    3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723,
    3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723,
    3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723,
    3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723,
    3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723,
    3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723,
    3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723,
    3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723,
    3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723,
    3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723,
    3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723,
    3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723, 3723,
    3723, 3723, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0,
};
extern const uint16_t sawtooth_wave[900] = {
    0, 4, 8, 12, 17, 21, 25, 29, 33, 37, 41, 46, 50, 54, 58, 62,
    66, 70, 74, 79, 83, 87, 91, 95, 99, 103, 108, 112, 116, 120, 124, 128,
    132, 137, 141, 145, 149, 153, 157, 161, 165, 170, 174, 178, 182, 186, 190, 194,
    199, 203, 207, 211, 215, 219, 223, 228, 232, 236, 240, 244, 248, 252, 256, 261,
    265, 269, 273, 277, 281, 285, 290, 294, 298, 302, 306, 310, 314, 319, 323, 327,
    331, 335, 339, 343, 347, 352, 356, 360, 364, 368, 372, 376, 381, 385, 389, 393,
    397, 401, 405, 410, 414, 418, 422, 426, 430, 434, 438, 443, 447, 451, 455, 459,
    463, 467, 472, 476, 480, 484, 488, 492, 496, 501, 505, 509, 513, 517, 521, 525,
    529, 534, 538, 542, 546, 550, 554, 558, 563, 567, 571, 575, 579, 583, 587, 592,
    596, 600, 604, 608, 612, 616, 620, 625, 629, 633, 637, 641, 645, 649, 654, 658,
    662, 666, 670, 674, 678, 683, 687, 691, 695, 699, 703, 707, 712, 716, 720, 724,
    728, 732, 736, 740, 745, 749, 753, 757, 761, 765, 769, 774, 778, 782, 786, 790,
    794, 798, 803, 807, 811, 815, 819, 823, 827, 831, 836, 840, 844, 848, 852, 856,
    860, 865, 869, 873, 877, 881, 885, 889, 894, 898, 902, 906, 910, 914, 918, 922,
    927, 931, 935, 939, 943, 947, 951, 956, 960, 964, 968, 972, 976, 980, 985, 989,
    993, 997, 1001, 1005, 1009, 1013, 1018, 1022, 1026, 1030, 1034, 1038, 1042, 1047, 1051, 1055,
    1059, 1063, 1067, 1071, 1076, 1080, 1084, 1088, 1092, 1096, 1100, 1104, 1109, 1113, 1117, 1121,
    1125, 1129, 1133, 1138, 1142, 1146, 1150, 1154, 1158, 1162, 1167, 1171, 1175, 1179, 1183, 1187,
    1191, 1195, 1200, 1204, 1208, 1212, 1216, 1220, 1224, 1229, 1233, 1237, 1241, 1245, 1249, 1253,
    1258, 1262, 1266, 1270, 1274, 1278, 1282, 1287, 1291, 1295, 1299, 1303, 1307, 1311, 1315, 1320,
    1324, 1328, 1332, 1336, 1340, 1344, 1349, 1353, 1357, 1361, 1365, 1369, 1373, 1378, 1382, 1386,
    1390, 1394, 1398, 1402, 1406, 1411, 1415, 1419, 1423, 1427, 1431, 1435, 1440, 1444, 1448, 1452,
    1456, 1460, 1464, 1469, 1473, 1477, 1481, 1485, 1489, 1493, 1497, 1502, 1506, 1510, 1514, 1518,
    1522, 1526, 1531, 1535, 1539, 1543, 1547, 1551, 1555, 1560, 1564, 1568, 1572, 1576, 1580, 1584,
    1588, 1593, 1597, 1601, 1605, 1609, 1613, 1617, 1622, 1626, 1630, 1634, 1638, 1642, 1646, 1651,
    1655, 1659, 1663, 1667, 1671, 1675, 1679, 1684, 1688, 1692, 1696, 1700, 1704, 1708, 1713, 1717,
    1721, 1725, 1729, 1733, 1737, 1742, 1746, 1750, 1754, 1758, 1762, 1766, 1770, 1775, 1779, 1783,
    1787, 1791, 1795, 1799, 1804, 1808, 1812, 1816, 1820, 1824, 1828, 1833, 1837, 1841, 1845, 1849,
    1853, 1857, 1862, 1866, 1870, 1874, 1878, 1882, 1886, 1890, 1895, 1899, 1903, 1907, 1911, 1915,
    1919, 1924, 1928, 1932, 1936, 1940, 1944, 1948, 1953, 1957, 1961, 1965, 1969, 1973, 1977, 1981,
    1986, 1990, 1994, 1998, 2002, 2006, 2010, 2015, 2019, 2023, 2027, 2031, 2035, 2039, 2044, 2048,
    2052, 2056, 2060, 2064, 2068, 2072, 2077, 2081, 2085, 2089, 2093, 2097, 2101, 2106, 2110, 2114,
    2118, 2122, 2126, 2130, 2135, 2139, 2143, 2147, 2151, 2155, 2159, 2163, 2168, 2172, 2176, 2180,
    2184, 2188, 2192, 2197, 2201, 2205, 2209, 2213, 2217, 2221, 2226, 2230, 2234, 2238, 2242, 2246,
    2250, 2254, 2259, 2263, 2267, 2271, 2275, 2279, 2283, 2288, 2292, 2296, 2300, 2304, 2308, 2312,
    2317, 2321, 2325, 2329, 2333, 2337, 2341, 2345, 2350, 2354, 2358, 2362, 2366, 2370, 2374, 2379,
    2383, 2387, 2391, 2395, 2399, 2403, 2408, 2412, 2416, 2420, 2424, 2428, 2432, 2436, 2441, 2445,
    2449, 2453, 2457, 2461, 2465, 2470, 2474, 2478, 2482, 2486, 2490, 2494, 2499, 2503, 2507, 2511,
    2515, 2519, 2523, 2528, 2532, 2536, 2540, 2544, 2548, 2552, 2556, 2561, 2565, 2569, 2573, 2577,
    2581, 2585, 2590, 2594, 2598, 2602, 2606, 2610, 2614, 2619, 2623, 2627, 2631, 2635, 2639, 2643,
    2647, 2652, 2656, 2660, 2664, 2668, 2672, 2676, 2681, 2685, 2689, 2693, 2697, 2701, 2705, 2710,
    2714, 2718, 2722, 2726, 2730, 2734, 2738, 2743, 2747, 2751, 2755, 2759, 2763, 2767, 2772, 2776,
    2780, 2784, 2788, 2792, 2796, 2801, 2805, 2809, 2813, 2817, 2821, 2825, 2829, 2834, 2838, 2842,
    2846, 2850, 2854, 2858, 2863, 2867, 2871, 2875, 2879, 2883, 2887, 2892, 2896, 2900, 2904, 2908,
    2912, 2916, 2920, 2925, 2929, 2933, 2937, 2941, 2945, 2949, 2954, 2958, 2962, 2966, 2970, 2974,
    2978, 2983, 2987, 2991, 2995, 2999, 3003, 3007, 3011, 3016, 3020, 3024, 3028, 3032, 3036, 3040,
    3045, 3049, 3053, 3057, 3061, 3065, 3069, 3074, 3078, 3082, 3086, 3090, 3094, 3098, 3103, 3107,
    3111, 3115, 3119, 3123, 3127, 3131, 3136, 3140, 3144, 3148, 3152, 3156, 3160, 3165, 3169, 3173,
    3177, 3181, 3185, 3189, 3194, 3198, 3202, 3206, 3210, 3214, 3218, 3222, 3227, 3231, 3235, 3239,
    3243, 3247, 3251, 3256, 3260, 3264, 3268, 3272, 3276, 3280, 3285, 3289, 3293, 3297, 3301, 3305,
    3309, 3313, 3318, 3322, 3326, 3330, 3334, 3338, 3342, 3347, 3351, 3355, 3359, 3363, 3367, 3371,
    3376, 3380, 3384, 3388, 3392, 3396, 3400, 3404, 3409, 3413, 3417, 3421, 3425, 3429, 3433, 3438,
    3442, 3446, 3450, 3454, 3458, 3462, 3467, 3471, 3475, 3479, 3483, 3487, 3491, 3495, 3500, 3504,
    3508, 3512, 3516, 3520, 3524, 3529, 3533, 3537, 3541, 3545, 3549, 3553, 3558, 3562, 3566, 3570,
    3574, 3578, 3582, 3586, 3591, 3595, 3599, 3603, 3607, 3611, 3615, 3620, 3624, 3628, 3632, 3636,
    3640, 3644, 3649, 3653, 3657, 3661, 3665, 3669, 3673, 3677, 3682, 3686, 3690, 3694, 3698, 3702,
    3706, 3711, 3715, 3719,
};
extern const uint16_t triangle_wave[900] = {
    0, 8, 17, 25, 33, 41, 50, 58, 66, 74, 83, 91, 99, 108, 116, 124,
    132, 141, 149, 157, 165, 174, 182, 190, 199, 207, 215, 223, 232, 240, 248, 256,
    265, 273, 281, 290, 298, 306, 314, 323, 331, 339, 347, 356, 364, 372, 381, 389,
    397, 405, 414, 422, 430, 438, 447, 455, 463, 472, 480, 488, 496, 505, 513, 521,
    529, 538, 546, 554, 563, 571, 579, 587, 596, 604, 612, 620, 629, 637, 645, 654,
    662, 670, 678, 687, 695, 703, 712, 720, 728, 736, 745, 753, 761, 769, 778, 786,
    794, 803, 811, 819, 827, 836, 844, 852, 860, 869, 877, 885, 894, 902, 910, 918,
    927, 935, 943, 951, 960, 968, 976, 985, 993, 1001, 1009, 1018, 1026, 1034, 1042, 1051,
    1059, 1067, 1076, 1084, 1092, 1100, 1109, 1117, 1125, 1133, 1142, 1150, 1158, 1167, 1175, 1183,
    1191, 1200, 1208, 1216, 1224, 1233, 1241, 1249, 1258, 1266, 1274, 1282, 1291, 1299, 1307, 1315,
    1324, 1332, 1340, 1349, 1357, 1365, 1373, 1382, 1390, 1398, 1406, 1415, 1423, 1431, 1440, 1448,
    1456, 1464, 1473, 1481, 1489, 1497, 1506, 1514, 1522, 1531, 1539, 1547, 1555, 1564, 1572, 1580,
    1588, 1597, 1605, 1613, 1622, 1630, 1638, 1646, 1655, 1663, 1671, 1679, 1688, 1696, 1704, 1713,
    1721, 1729, 1737, 1746, 1754, 1762, 1770, 1779, 1787, 1795, 1804, 1812, 1820, 1828, 1837, 1845,
    1853, 1862, 1870, 1878, 1886, 1895, 1903, 1911, 1919, 1928, 1936, 1944, 1953, 1961, 1969, 1977,
    1986, 1994, 2002, 2010, 2019, 2027, 2035, 2044, 2052, 2060, 2068, 2077, 2085, 2093, 2101, 2110,
    2118, 2126, 2135, 2143, 2151, 2159, 2168, 2176, 2184, 2192, 2201, 2209, 2217, 2226, 2234, 2242,
    2250, 2259, 2267, 2275, 2283, 2292, 2300, 2308, 2317, 2325, 2333, 2341, 2350, 2358, 2366, 2374,
    2383, 2391, 2399, 2408, 2416, 2424, 2432, 2441, 2449, 2457, 2465, 2474, 2482, 2490, 2499, 2507,
    2515, 2523, 2532, 2540, 2548, 2556, 2565, 2573, 2581, 2590, 2598, 2606, 2614, 2623, 2631, 2639,
    2647, 2656, 2664, 2672, 2681, 2689, 2697, 2705, 2714, 2722, 2730, 2738, 2747, 2755, 2763, 2772,
    2780, 2788, 2796, 2805, 2813, 2821, 2829, 2838, 2846, 2854, 2863, 2871, 2879, 2887, 2896, 2904,
    2912, 2920, 2929, 2937, 2945, 2954, 2962, 2970, 2978, 2987, 2995, 3003, 3011, 3020, 3028, 3036,
    3045, 3053, 3061, 3069, 3078, 3086, 3094, 3103, 3111, 3119, 3127, 3136, 3144, 3152, 3160, 3169,
    3177, 3185, 3194, 3202, 3210, 3218, 3227, 3235, 3243, 3251, 3260, 3268, 3276, 3285, 3293, 3301,
    3309, 3318, 3326, 3334, 3342, 3351, 3359, 3367, 3376, 3384, 3392, 3400, 3409, 3417, 3425, 3433,
    3442, 3450, 3458, 3467, 3475, 3483, 3491, 3500, 3508, 3516, 3524, 3533, 3541, 3549, 3558, 3566,
    3574, 3582, 3591, 3599, 3607, 3615, 3624, 3632, 3640, 3649, 3657, 3665, 3673, 3682, 3690, 3698,
    3706, 3715, 3723, 3715, 3706, 3698, 3690, 3682, 3673, 3665, 3657, 3649, 3640, 3632, 3624, 3615,
    3607, 3599, 3591, 3582, 3574, 3566, 3558, 3549, 3541, 3533, 3524, 3516, 3508, 3500, 3491, 3483,
    3475, 3467, 3458, 3450, 3442, 3433, 3425, 3417, 3409, 3400, 3392, 3384, 3376, 3367, 3359, 3351,
    3342, 3334, 3326, 3318, 3309, 3301, 3293, 3285, 3276, 3268, 3260, 3251, 3243, 3235, 3227, 3218,
    3210, 3202, 3194, 3185, 3177, 3169, 3160, 3152, 3144, 3136, 3127, 3119, 3111, 3102, 3094, 3086,
    3078, 3069, 3061, 3053, 3045, 3036, 3028, 3020, 3011, 3003, 2995, 2987, 2978, 2970, 2962, 2954,
    2945, 2937, 2929, 2920, 2912, 2904, 2896, 2887, 2879, 2871, 2863, 2854, 2846, 2838, 2829, 2821,
    2813, 2805, 2796, 2788, 2780, 2772, 2763, 2755, 2747, 2738, 2730, 2722, 2714, 2705, 2697, 2689,
    2681, 2672, 2664, 2656, 2647, 2639, 2631, 2623, 2614, 2606, 2598, 2590, 2581, 2573, 2565, 2556,
    2548, 2540, 2532, 2523, 2515, 2507, 2499, 2490, 2482, 2474, 2465, 2457, 2449, 2441, 2432, 2424,
    2416, 2408, 2399, 2391, 2383, 2374, 2366, 2358, 2350, 2341, 2333, 2325, 2317, 2308, 2300, 2292,
    2283, 2275, 2267, 2259, 2250, 2242, 2234, 2226, 2217, 2209, 2201, 2192, 2184, 2176, 2168, 2159,
    2151, 2143, 2135, 2126, 2118, 2110, 2101, 2093, 2085, 2077, 2068, 2060, 2052, 2044, 2035, 2027,
    2019, 2010, 2002, 1994, 1986, 1977, 1969, 1961, 1953, 1944, 1936, 1928, 1919, 1911, 1903, 1895,
    1886, 1878, 1870, 1862, 1853, 1845, 1837, 1828, 1820, 1812, 1804, 1795, 1787, 1779, 1770, 1762,
    1754, 1746, 1737, 1729, 1721, 1713, 1704, 1696, 1688, 1679, 1671, 1663, 1655, 1646, 1638, 1630,
    1622, 1613, 1605, 1597, 1588, 1580, 1572, 1564, 1555, 1547, 1539, 1531, 1522, 1514, 1506, 1497,
    1489, 1481, 1473, 1464, 1456, 1448, 1440, 1431, 1423, 1415, 1406, 1398, 1390, 1382, 1373, 1365,
    1357, 1349, 1340, 1332, 1324, 1315, 1307, 1299, 1291, 1282, 1274, 1266, 1258, 1249, 1241, 1233,
    1224, 1216, 1208, 1200, 1191, 1183, 1175, 1167, 1158, 1150, 1142, 1133, 1125, 1117, 1109, 1100,
    1092, 1084, 1076, 1067, 1059, 1051, 1042, 1034, 1026, 1018, 1009, 1001, 993, 985, 976, 968,
    960, 951, 943, 935, 927, 918, 910, 902, 894, 885, 877, 869, 860, 852, 844, 836,
    827, 819, 811, 803, 794, 786, 778, 769, 761, 753, 745, 736, 728, 720, 712, 703,
    695, 687, 678, 670, 662, 654, 645, 637, 629, 620, 612, 604, 596, 587, 579, 571,
    563, 554, 546, 538, 529, 521, 513, 505, 496, 488, 480, 472, 463, 455, 447, 438,
    430, 422, 414, 405, 397, 389, 381, 372, 364, 356, 347, 339, 331, 323, 314, 306,
    298, 290, 281, 273, 265, 256, 248, 240, 232, 223, 215, 207, 199, 190, 182, 174,
    165, 157, 149, 141, 132, 124, 116, 108, 99, 91, 83, 74, 66, 58, 50, 41,
    33, 25, 17, 8,
};
External_DAC::External_DAC() {

}

External_DAC::~External_DAC() {
}

void External_DAC::DAC_init(void)
{
    RCC->AHB2ENR |= RCC_AHB2ENR_GPIOAEN;
    GPIOA->MODER &= ~(GPIO_MODER_MODE4 | GPIO_MODER_MODE5 | GPIO_MODER_MODE6 | GPIO_MODER_MODE7);
    GPIOA->MODER |= (GPIO_MODER_MODE4_1 | GPIO_MODER_MODE5_1 | GPIO_MODER_MODE6_1 | GPIO_MODER_MODE7_1);
    GPIOA->AFR[0] &= ~(GPIO_AFRL_AFSEL4 | GPIO_AFRL_AFSEL5 | GPIO_AFRL_AFSEL6 | GPIO_AFRL_AFSEL7);
    GPIOA->AFR[0] |= ((5 << GPIO_AFRL_AFSEL4_Pos) | (5 << GPIO_AFRL_AFSEL5_Pos) | (5 << GPIO_AFRL_AFSEL6_Pos) | (5 << GPIO_AFRL_AFSEL7_Pos));
    GPIOA->OTYPER &= ~(GPIO_OTYPER_OT4 | GPIO_OTYPER_OT5 | GPIO_OTYPER_OT6 | GPIO_OTYPER_OT7);
    GPIOA->PUPDR &= ~(GPIO_PUPDR_PUPD4 | GPIO_PUPDR_PUPD5 | GPIO_PUPDR_PUPD6 | GPIO_PUPDR_PUPD7);
    RCC->APB2ENR |= RCC_APB2ENR_SPI1EN;
    SPI1->CR1 = SPI_CR1_MSTR | SPI_CR1_BR_1;  // Set prescaler to fPCLK/4
    SPI1->CR2 = SPI_CR2_SSOE | SPI_CR2_NSSP | (0xF << SPI_CR2_DS_Pos);
    SPI1->CR1 |= SPI_CR1_SPE;
}

// Convert a voltage value into a 12-bit value to control the DAC
uint16_t External_DAC::DAC_mvolt_convert(float mvoltage)
{
	return (mvoltage * 4095) / 3300;
}

void External_DAC::DAC_write(uint16_t value_A, uint16_t value_B)
//void External_DAC::DAC_write(uint16_t value_A)
{
    uint16_t spi_data_A = (value_A & 0x0FFF) | 0x3000;  // For DACA
    uint16_t spi_data_B = (value_B & 0x0FFF) | 0xB000;  // For DACB

    // Write to DACA
    while(!(SPI1->SR & SPI_SR_TXE));
    SPI1->DR = spi_data_A;

    // Write to DACB
    while(!(SPI1->SR & SPI_SR_TXE));
    SPI1->DR = spi_data_B;
}


/* Matlab script for generating lookup tables
% Parameters
fs = 256;  % Sampling frequency
t = 0:1/fs:1-1/fs;  % Time vector
Vref = 3.3;  % Reference voltage
bit_depth = 4095;  % 12-bit DAC
dc_offset = 1.5;  % DC offset in volts
Vpp = 3.0;  % Peak-to-peak voltage in volts

% Scaling factors
scale_factor = bit_depth / Vref;
dc_offset_scaled = round(dc_offset * scale_factor);
amplitude_scaled = round((Vpp / 2) * scale_factor);

% Generate Sine Wave
sine_wave = round(dc_offset_scaled + amplitude_scaled * sin(2 * pi * t));

% Generate Square Wave
square_wave = round(dc_offset_scaled + amplitude_scaled * (square(2 * pi * t) + 1) / 2);

% Generate Triangle Wave
triangle_wave = round(dc_offset_scaled + amplitude_scaled * (sawtooth(2 * pi * t, 0.5) + 1) / 2);

% Generate Sawtooth Wave
sawtooth_wave = round(dc_offset_scaled + amplitude_scaled * (sawtooth(2 * pi * t) + 1) / 2);

% Print Lookup Tables
print_lookup_table('sine_wave', sine_wave);
print_lookup_table('square_wave', square_wave);
print_lookup_table('sawtooth_wave', sawtooth_wave);
print_lookup_table('triangle_wave', triangle_wave);

% Function to print lookup table in 16x16 format
function print_lookup_table(name, data)
    fprintf('extern const uint16_t %s[%d] = {\n', name, length(data));
    for i = 1:16:length(data)
        fprintf('    ');
        fprintf('%d, ', data(i:min(i+15, end)));
        fprintf('\n');
    end
    fprintf('};\n');
end
 */





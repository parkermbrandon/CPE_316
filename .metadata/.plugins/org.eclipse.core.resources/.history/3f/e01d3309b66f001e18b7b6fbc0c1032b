#include "ExternalDAC.h"

extern const uint16_t sine_wave[600] = {
    1861, 1880, 1900, 1919, 1939, 1958, 1978, 1997, 2017, 2036, 2056, 2075, 2094, 2114, 2133, 2152,
    2171, 2191, 2210, 2229, 2248, 2267, 2286, 2305, 2324, 2343, 2361, 2380, 2399, 2418, 2436, 2455,
    2473, 2491, 2510, 2528, 2546, 2564, 2582, 2600, 2618, 2636, 2653, 2671, 2688, 2706, 2723, 2740,
    2758, 2775, 2792, 2808, 2825, 2842, 2858, 2875, 2891, 2907, 2923, 2939, 2955, 2971, 2986, 3002,
    3017, 3032, 3047, 3062, 3077, 3092, 3106, 3121, 3135, 3149, 3163, 3177, 3191, 3204, 3218, 3231,
    3244, 3257, 3270, 3282, 3295, 3307, 3319, 3331, 3343, 3355, 3367, 3378, 3389, 3400, 3411, 3422,
    3432, 3443, 3453, 3463, 3473, 3482, 3492, 3501, 3510, 3519, 3528, 3536, 3545, 3553, 3561, 3569,
    3577, 3584, 3591, 3598, 3605, 3612, 3618, 3625, 3631, 3637, 3643, 3648, 3653, 3659, 3664, 3668,
    3673, 3677, 3681, 3685, 3689, 3693, 3696, 3699, 3702, 3705, 3707, 3710, 3712, 3714, 3715, 3717,
    3718, 3719, 3720, 3721, 3722, 3722, 3722, 3722, 3722, 3721, 3720, 3719, 3718, 3717, 3715, 3714,
    3712, 3710, 3707, 3705, 3702, 3699, 3696, 3693, 3689, 3685, 3681, 3677, 3673, 3668, 3664, 3659,
    3653, 3648, 3643, 3637, 3631, 3625, 3618, 3612, 3605, 3598, 3591, 3584, 3577, 3569, 3561, 3553,
    3545, 3536, 3528, 3519, 3510, 3501, 3492, 3482, 3473, 3463, 3453, 3443, 3432, 3422, 3411, 3400,
    3389, 3378, 3367, 3355, 3343, 3331, 3319, 3307, 3295, 3282, 3270, 3257, 3244, 3231, 3218, 3204,
    3191, 3177, 3163, 3149, 3135, 3121, 3106, 3092, 3077, 3062, 3047, 3032, 3017, 3002, 2986, 2971,
    2955, 2939, 2923, 2907, 2891, 2875, 2858, 2842, 2825, 2808, 2792, 2775, 2758, 2740, 2723, 2706,
    2688, 2671, 2653, 2636, 2618, 2600, 2582, 2564, 2546, 2528, 2510, 2491, 2473, 2455, 2436, 2418,
    2399, 2380, 2361, 2343, 2324, 2305, 2286, 2267, 2248, 2229, 2210, 2191, 2171, 2152, 2133, 2114,
    2094, 2075, 2056, 2036, 2017, 1997, 1978, 1958, 1939, 1919, 1900, 1880, 1861, 1842, 1822, 1803,
    1783, 1764, 1744, 1725, 1705, 1686, 1666, 1647, 1628, 1608, 1589, 1570, 1551, 1531, 1512, 1493,
    1474, 1455, 1436, 1417, 1398, 1379, 1361, 1342, 1323, 1304, 1286, 1267, 1249, 1231, 1212, 1194,
    1176, 1158, 1140, 1122, 1104, 1086, 1069, 1051, 1034, 1016, 999, 982, 964, 947, 931, 914,
    897, 880, 864, 847, 831, 815, 799, 783, 767, 751, 736, 720, 705, 690, 675, 660,
    645, 630, 616, 601, 587, 573, 559, 545, 531, 518, 504, 491, 478, 465, 452, 440,
    427, 415, 403, 391, 379, 367, 355, 344, 333, 322, 311, 300, 290, 279, 269, 259,
    249, 240, 230, 221, 212, 203, 194, 186, 177, 169, 161, 153, 145, 138, 131, 124,
    117, 110, 104, 97, 91, 85, 79, 74, 69, 63, 58, 54, 49, 45, 41, 37,
    33, 29, 26, 23, 20, 17, 15, 12, 10, 8, 7, 5, 4, 3, 2, 1,
    0, 0, 0, 0, 0, 1, 2, 3, 4, 5, 7, 8, 10, 12, 15, 17,
    20, 23, 26, 29, 33, 37, 41, 45, 49, 54, 58, 63, 69, 74, 79, 85,
    91, 97, 104, 110, 117, 124, 131, 138, 145, 153, 161, 169, 177, 186, 194, 203,
    212, 221, 230, 240, 249, 259, 269, 279, 290, 300, 311, 322, 333, 344, 355, 367,
    379, 391, 403, 415, 427, 440, 452, 465, 478, 491, 504, 518, 531, 545, 559, 573,
    587, 601, 616, 630, 645, 660, 675, 690, 705, 720, 736, 751, 767, 783, 799, 815,
    831, 847, 864, 880, 897, 914, 930, 947, 964, 982, 999, 1016, 1034, 1051, 1069, 1086,
    1104, 1122, 1140, 1158, 1176, 1194, 1212, 1231, 1249, 1267, 1286, 1304, 1323, 1342, 1361, 1379,
    1398, 1417, 1436, 1455, 1474, 1493, 1512, 1531, 1551, 1570, 1589, 1608, 1628, 1647, 1666, 1686,
    1705, 1725, 1744, 1764, 1783, 1803, 1822, 1842,
};
extern const uint16_t square_wave[600] = {
    5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597,
    5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597,
    5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597,
    5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597,
    5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597,
    5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597,
    5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597,
    5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597,
    5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597,
    5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597,
    5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597,
    5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597,
    5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597,
    5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597,
    5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597,
    5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597,
    5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597,
    5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597,
    5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 5597, 1875, 1875, 1875,
    1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875,
    1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875,
    1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875,
    1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875,
    1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875,
    1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875,
    1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875,
    1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875,
    1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875,
    1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875,
    1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875,
    1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875,
    1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875,
    1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875,
    1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875,
    1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875,
    1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875,
    1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875,
    1875, 1875, 1875, 1875, 1875, 1875, 1875, 1875,
};
extern const uint16_t sawtooth_wave[600] = {
    1921, 1927, 1933, 1940, 1946, 1952, 1958, 1964, 1971, 1977, 1983, 1989, 1995, 2002, 2008, 2014,
    2020, 2026, 2033, 2039, 2045, 2051, 2057, 2064, 2070, 2076, 2082, 2088, 2095, 2101, 2107, 2113,
    2120, 2126, 2132, 2138, 2144, 2151, 2157, 2163, 2169, 2175, 2182, 2188, 2194, 2200, 2206, 2213,
    2219, 2225, 2231, 2237, 2244, 2250, 2256, 2262, 2268, 2275, 2281, 2287, 2293, 2299, 2306, 2312,
    2318, 2324, 2330, 2337, 2343, 2349, 2355, 2361, 2368, 2374, 2380, 2386, 2392, 2399, 2405, 2411,
    2417, 2423, 2430, 2436, 2442, 2448, 2454, 2461, 2467, 2473, 2479, 2486, 2492, 2498, 2504, 2510,
    2517, 2523, 2529, 2535, 2541, 2548, 2554, 2560, 2566, 2572, 2579, 2585, 2591, 2597, 2603, 2610,
    2616, 2622, 2628, 2634, 2641, 2647, 2653, 2659, 2665, 2672, 2678, 2684, 2690, 2696, 2703, 2709,
    2715, 2721, 2727, 2734, 2740, 2746, 2752, 2758, 2765, 2771, 2777, 2783, 2789, 2796, 2802, 2808,
    2814, 2820, 2827, 2833, 2839, 2845, 2852, 2858, 2864, 2870, 2876, 2883, 2889, 2895, 2901, 2907,
    2914, 2920, 2926, 2932, 2938, 2945, 2951, 2957, 2963, 2969, 2976, 2982, 2988, 2994, 3000, 3007,
    3013, 3019, 3025, 3031, 3038, 3044, 3050, 3056, 3062, 3069, 3075, 3081, 3087, 3093, 3100, 3106,
    3112, 3118, 3124, 3131, 3137, 3143, 3149, 3155, 3162, 3168, 3174, 3180, 3186, 3193, 3199, 3205,
    3211, 3217, 3224, 3230, 3236, 3242, 3249, 3255, 3261, 3267, 3273, 3280, 3286, 3292, 3298, 3304,
    3311, 3317, 3323, 3329, 3335, 3342, 3348, 3354, 3360, 3366, 3373, 3379, 3385, 3391, 3397, 3404,
    3410, 3416, 3422, 3428, 3435, 3441, 3447, 3453, 3459, 3466, 3472, 3478, 3484, 3490, 3497, 3503,
    3509, 3515, 3521, 3528, 3534, 3540, 3546, 3552, 3559, 3565, 3571, 3577, 3583, 3590, 3596, 3602,
    3608, 3615, 3621, 3627, 3633, 3639, 3646, 3652, 3658, 3664, 3670, 3677, 3683, 3689, 3695, 3701,
    3708, 3714, 3720, 3726, 3732, 3739, 3745, 3751, 3757, 3763, 3770, 3776, 3782, 3788, 3794, 3801,
    3807, 3813, 3819, 3825, 3832, 3838, 3844, 3850, 3856, 3863, 3869, 3875, 3881, 3887, 3894, 3900,
    3906, 3912, 3918, 3925, 3931, 3937, 3943, 3949, 3956, 3962, 3968, 3974, 3981, 3987, 3993, 3999,
    4005, 4012, 4018, 4024, 4030, 4036, 4043, 4049, 4055, 4061, 4067, 4074, 4080, 4086, 4092, 4098,
    4105, 4111, 4117, 4123, 4129, 4136, 4142, 4148, 4154, 4160, 4167, 4173, 4179, 4185, 4191, 4198,
    4204, 4210, 4216, 4222, 4229, 4235, 4241, 4247, 4253, 4260, 4266, 4272, 4278, 4284, 4291, 4297,
    4303, 4309, 4315, 4322, 4328, 4334, 4340, 4347, 4353, 4359, 4365, 4371, 4378, 4384, 4390, 4396,
    4402, 4409, 4415, 4421, 4427, 4433, 4440, 4446, 4452, 4458, 4464, 4471, 4477, 4483, 4489, 4495,
    4502, 4508, 4514, 4520, 4526, 4533, 4539, 4545, 4551, 4557, 4564, 4570, 4576, 4582, 4588, 4595,
    4601, 4607, 4613, 4619, 4626, 4632, 4638, 4644, 4650, 4657, 4663, 4669, 4675, 4681, 4688, 4694,
    4700, 4706, 4713, 4719, 4725, 4731, 4737, 4744, 4750, 4756, 4762, 4768, 4775, 4781, 4787, 4793,
    4799, 4806, 4812, 4818, 4824, 4830, 4837, 4843, 4849, 4855, 4861, 4868, 4874, 4880, 4886, 4892,
    4899, 4905, 4911, 4917, 4923, 4930, 4936, 4942, 4948, 4954, 4961, 4967, 4973, 4979, 4985, 4992,
    4998, 5004, 5010, 5016, 5023, 5029, 5035, 5041, 5047, 5054, 5060, 5066, 5072, 5078, 5085, 5091,
    5097, 5103, 5110, 5116, 5122, 5128, 5134, 5141, 5147, 5153, 5159, 5165, 5172, 5178, 5184, 5190,
    5196, 5203, 5209, 5215, 5221, 5227, 5234, 5240, 5246, 5252, 5258, 5265, 5271, 5277, 5283, 5289,
    5296, 5302, 5308, 5314, 5320, 5327, 5333, 5339, 5345, 5351, 5358, 5364, 5370, 5376, 5382, 5389,
    5395, 5401, 5407, 5413, 5420, 5426, 5432, 5438, 5444, 5451, 5457, 5463, 5469, 5476, 5482, 5488,
    5494, 5500, 5507, 5513, 5519, 5525, 5531, 5538, 5544, 5550, 5556, 5562, 5569, 5575, 5581, 5587,
    5593, 5600, 5606, 5612, 5618, 5624, 5631, 5637,
};
extern const uint16_t triangle_wave[600] = {
    1881, 1893, 1906, 1918, 1931, 1943, 1955, 1968, 1980, 1993, 2005, 2017, 2030, 2042, 2055, 2067,
    2080, 2092, 2104, 2117, 2129, 2142, 2154, 2166, 2179, 2191, 2204, 2216, 2228, 2241, 2253, 2266,
    2278, 2290, 2303, 2315, 2328, 2340, 2352, 2365, 2377, 2390, 2402, 2414, 2427, 2439, 2452, 2464,
    2477, 2489, 2501, 2514, 2526, 2539, 2551, 2563, 2576, 2588, 2601, 2613, 2625, 2638, 2650, 2663,
    2675, 2687, 2700, 2712, 2725, 2737, 2749, 2762, 2774, 2787, 2799, 2812, 2824, 2836, 2849, 2861,
    2874, 2886, 2898, 2911, 2923, 2936, 2948, 2960, 2973, 2985, 2998, 3010, 3022, 3035, 3047, 3060,
    3072, 3084, 3097, 3109, 3122, 3134, 3146, 3159, 3171, 3184, 3196, 3209, 3221, 3233, 3246, 3258,
    3271, 3283, 3295, 3308, 3320, 3333, 3345, 3357, 3370, 3382, 3395, 3407, 3419, 3432, 3444, 3457,
    3469, 3481, 3494, 3506, 3519, 3531, 3543, 3556, 3568, 3581, 3593, 3606, 3618, 3630, 3643, 3655,
    3668, 3680, 3692, 3705, 3717, 3730, 3742, 3754, 3767, 3779, 3792, 3804, 3816, 3829, 3841, 3854,
    3866, 3878, 3891, 3903, 3916, 3928, 3941, 3953, 3965, 3978, 3990, 4003, 4015, 4027, 4040, 4052,
    4065, 4077, 4089, 4102, 4114, 4127, 4139, 4151, 4164, 4176, 4189, 4201, 4213, 4226, 4238, 4251,
    4263, 4275, 4288, 4300, 4313, 4325, 4338, 4350, 4362, 4375, 4387, 4400, 4412, 4424, 4437, 4449,
    4462, 4474, 4486, 4499, 4511, 4524, 4536, 4548, 4561, 4573, 4586, 4598, 4610, 4623, 4635, 4648,
    4660, 4673, 4685, 4697, 4710, 4722, 4735, 4747, 4759, 4772, 4784, 4797, 4809, 4821, 4834, 4846,
    4859, 4871, 4883, 4896, 4908, 4921, 4933, 4945, 4958, 4970, 4983, 4995, 5007, 5020, 5032, 5045,
    5057, 5070, 5082, 5094, 5107, 5119, 5132, 5144, 5156, 5169, 5181, 5194, 5206, 5218, 5231, 5243,
    5256, 5268, 5280, 5293, 5305, 5318, 5330, 5342, 5355, 5367, 5380, 5392, 5404, 5417, 5429, 5442,
    5454, 5467, 5479, 5491, 5504, 5516, 5529, 5541, 5553, 5566, 5578, 5591, 5603, 5591, 5578, 5566,
    5553, 5541, 5529, 5516, 5504, 5491, 5479, 5467, 5454, 5442, 5429, 5417, 5404, 5392, 5380, 5367,
    5355, 5342, 5330, 5318, 5305, 5293, 5280, 5268, 5256, 5243, 5231, 5218, 5206, 5194, 5181, 5169,
    5156, 5144, 5132, 5119, 5107, 5094, 5082, 5070, 5057, 5045, 5032, 5020, 5007, 4995, 4983, 4970,
    4958, 4945, 4933, 4921, 4908, 4896, 4883, 4871, 4859, 4846, 4834, 4821, 4809, 4797, 4784, 4772,
    4759, 4747, 4735, 4722, 4710, 4697, 4685, 4673, 4660, 4648, 4635, 4623, 4610, 4598, 4586, 4573,
    4561, 4548, 4536, 4524, 4511, 4499, 4486, 4474, 4462, 4449, 4437, 4424, 4412, 4400, 4387, 4375,
    4362, 4350, 4338, 4325, 4313, 4300, 4288, 4275, 4263, 4251, 4238, 4226, 4213, 4201, 4189, 4176,
    4164, 4151, 4139, 4127, 4114, 4102, 4089, 4077, 4065, 4052, 4040, 4027, 4015, 4003, 3990, 3978,
    3965, 3953, 3941, 3928, 3916, 3903, 3891, 3878, 3866, 3854, 3841, 3829, 3816, 3804, 3792, 3779,
    3767, 3754, 3742, 3730, 3717, 3705, 3692, 3680, 3668, 3655, 3643, 3630, 3618, 3606, 3593, 3581,
    3568, 3556, 3543, 3531, 3519, 3506, 3494, 3481, 3469, 3457, 3444, 3432, 3419, 3407, 3395, 3382,
    3370, 3357, 3345, 3333, 3320, 3308, 3295, 3283, 3271, 3258, 3246, 3233, 3221, 3209, 3196, 3184,
    3171, 3159, 3146, 3134, 3122, 3109, 3097, 3084, 3072, 3060, 3047, 3035, 3022, 3010, 2998, 2985,
    2973, 2960, 2948, 2936, 2923, 2911, 2898, 2886, 2874, 2861, 2849, 2836, 2824, 2812, 2799, 2787,
    2774, 2762, 2749, 2737, 2725, 2712, 2700, 2687, 2675, 2663, 2650, 2638, 2625, 2613, 2601, 2588,
    2576, 2563, 2551, 2539, 2526, 2514, 2501, 2489, 2477, 2464, 2452, 2439, 2427, 2414, 2402, 2390,
    2377, 2365, 2352, 2340, 2328, 2315, 2303, 2290, 2278, 2266, 2253, 2241, 2228, 2216, 2204, 2191,
    2179, 2166, 2154, 2142, 2129, 2117, 2104, 2092, 2080, 2067, 2055, 2042, 2030, 2017, 2005, 1993,
    1980, 1968, 1955, 1943, 1931, 1918, 1906, 1893,
};
External_DAC::External_DAC() {

}

External_DAC::~External_DAC() {
}

void External_DAC::DAC_init(void)
{
    RCC->AHB2ENR |= RCC_AHB2ENR_GPIOAEN;
    GPIOA->MODER &= ~(GPIO_MODER_MODE4 | GPIO_MODER_MODE5 | GPIO_MODER_MODE6 | GPIO_MODER_MODE7);
    GPIOA->MODER |= (GPIO_MODER_MODE4_1 | GPIO_MODER_MODE5_1 | GPIO_MODER_MODE6_1 | GPIO_MODER_MODE7_1);
    GPIOA->AFR[0] &= ~(GPIO_AFRL_AFSEL4 | GPIO_AFRL_AFSEL5 | GPIO_AFRL_AFSEL6 | GPIO_AFRL_AFSEL7);
    GPIOA->AFR[0] |= ((5 << GPIO_AFRL_AFSEL4_Pos) | (5 << GPIO_AFRL_AFSEL5_Pos) | (5 << GPIO_AFRL_AFSEL6_Pos) | (5 << GPIO_AFRL_AFSEL7_Pos));
    GPIOA->OTYPER &= ~(GPIO_OTYPER_OT4 | GPIO_OTYPER_OT5 | GPIO_OTYPER_OT6 | GPIO_OTYPER_OT7);
    GPIOA->PUPDR &= ~(GPIO_PUPDR_PUPD4 | GPIO_PUPDR_PUPD5 | GPIO_PUPDR_PUPD6 | GPIO_PUPDR_PUPD7);
    RCC->APB2ENR |= RCC_APB2ENR_SPI1EN;
    SPI1->CR1 = SPI_CR1_MSTR | SPI_CR1_BR_1;  // Set prescaler to fPCLK/4
    SPI1->CR2 = SPI_CR2_SSOE | SPI_CR2_NSSP | (0xF << SPI_CR2_DS_Pos);
    SPI1->CR1 |= SPI_CR1_SPE;
}

// Convert a voltage value into a 12-bit value to control the DAC
uint16_t External_DAC::DAC_mvolt_convert(float mvoltage)
{
	return (mvoltage * 4095) / 3300;
}

void External_DAC::DAC_write(uint16_t value_A, uint16_t value_B)
//void External_DAC::DAC_write(uint16_t value_A)
{
    uint16_t spi_data_A = (value_A & 0x0FFF) | 0x3000;  // For DACA
    uint16_t spi_data_B = (value_B & 0x0FFF) | 0xB000;  // For DACB

    // Write to DACA
    while(!(SPI1->SR & SPI_SR_TXE));
    SPI1->DR = spi_data_A;

    // Write to DACB
    while(!(SPI1->SR & SPI_SR_TXE));
    SPI1->DR = spi_data_B;
}


/* Matlab script for generating lookup tables
% Parameters
fs = 256;  % Sampling frequency
t = 0:1/fs:1-1/fs;  % Time vector
Vref = 3.3;  % Reference voltage
bit_depth = 4095;  % 12-bit DAC
dc_offset = 1.5;  % DC offset in volts
Vpp = 3.0;  % Peak-to-peak voltage in volts

% Scaling factors
scale_factor = bit_depth / Vref;
dc_offset_scaled = round(dc_offset * scale_factor);
amplitude_scaled = round((Vpp / 2) * scale_factor);

% Generate Sine Wave
sine_wave = round(dc_offset_scaled + amplitude_scaled * sin(2 * pi * t));

% Generate Square Wave
square_wave = round(dc_offset_scaled + amplitude_scaled * (square(2 * pi * t) + 1) / 2);

% Generate Triangle Wave
triangle_wave = round(dc_offset_scaled + amplitude_scaled * (sawtooth(2 * pi * t, 0.5) + 1) / 2);

% Generate Sawtooth Wave
sawtooth_wave = round(dc_offset_scaled + amplitude_scaled * (sawtooth(2 * pi * t) + 1) / 2);

% Print Lookup Tables
print_lookup_table('sine_wave', sine_wave);
print_lookup_table('square_wave', square_wave);
print_lookup_table('sawtooth_wave', sawtooth_wave);
print_lookup_table('triangle_wave', triangle_wave);

% Function to print lookup table in 16x16 format
function print_lookup_table(name, data)
    fprintf('extern const uint16_t %s[%d] = {\n', name, length(data));
    for i = 1:16:length(data)
        fprintf('    ');
        fprintf('%d, ', data(i:min(i+15, end)));
        fprintf('\n');
    end
    fprintf('};\n');
end
 */




